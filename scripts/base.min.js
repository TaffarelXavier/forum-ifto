/*Desenvolvido por Taffarel Xavier*/
$(document).ready(function(){var h=$("#btnEnviar"),f=$("#labelError"),k=$("#formEnviarMsg"),m=$("#msg"),g=$("#btnFecharImgPreview"),i=false,d=new URL(window.location.href);var l=parseInt(d.searchParams.get("discussao"));h.click(function(){if(m.val().trim().length>0){k.submit()}else{if(i==true){f.html("Digite um título para sua imagem").show().delay(3000).fadeOut()}else{f.html("Digite alguma mensagem").show().delay(3000).fadeOut()}m.focus()}});function e(){var p=screen.availHeight;$("#resultado").animate({scrollTop:parseInt($("#resultado").prop("scrollHeight"))*p},1000)}e();$.get("../views/view.get_messages.php",{discussao_id:l},function(p){o(p)});var c=["#99b433","#00a300","#1e7145","#ff0097","#7e3878","#ee1111","#2B70AD","#1d1d1d","#00aba9","#2d89ef","#2b5797","#ffc40d","#e3a21a","#da532c"];$("#resultado").scroll(function(q){var p=$(this).scrollTop();if(p>=150){$("#goParaTopo").slideDown()}else{$("#goParaTopo").slideUp()}});function j(r){$(r).css({display:"block",width:200+"px",height:200+"px"});var q=$(r).attr("src");var p=window.open("_top");p.document.write("<img src='"+q+"' />");p.document.title="Visualização de Imagem"}function o(q){var t=JSON.parse(q),u="",p=0,s=new Date(),r=s.getHours()+":"+s.getMinutes(),v="Esta é uma mensagem fixa";u+='<div class="row-fluid"><div class="mensagens"><p><b style="color:'+c[6]+' ">Usuário padrão.</b></p><p><pre>'+v+'</pre></p><label class="text-info data-msg" title="'+s.getDate()+"-"+(s.getMonth()+1)+"-"+s.getFullYear()+'">'+r+'</label><hr class="msg-hr"/></div></div>';$.each(t,function(x,y){s=new Date(y.men_data*1000),r=s.getHours()+":"+s.getMinutes(),img="",_rand=parseInt(Math.random()*(c.length-0)+0);switch(y.men_tipo){case"image":img+="<a><img src='"+y.men_image+"' class='msg-imagens img-responsive'  /></a>";break;case"arquivos":if(y.imagens){if(y.imagens.length>0){for(var w=0;w<y.imagens.length;w++){img+="<a><img src='../uploads/"+y.imagens[w].arq_file_md5+"' class='msg-imagens img-responsive'  /></a>"}}}break}while(p<c.length){p++}u+='<div class="row-fluid"><div class="mensagens"><p><b style="color:'+c[0]+' ">&nbsp;<i>'+y.nome+"</i></b></p><p><pre>"+y.men_mensagens+"</pre></p>"+img+'<div class="clearfix"></div><label class="text-info data-msg" title="'+s.getDate()+"-"+(s.getMonth()+1)+"-"+s.getFullYear()+'">'+r+'</label><hr class="msg-hr"/></div></div>'});$("#resultado").html(u);$(".msg-imagens").click(function(){var w=$(this);j(w)})}$("#goParaTopo").click(function(){var p=$(this);p.slideUp();$("#resultado").animate({scrollTop:parseInt(0)},500)});document.getElementById("msg").onpaste=function(t){var r=(t.clipboardData||t.originalEvent.clipboardData).items;var q=null;for(var s=0;s<r.length;s++){if(r[s].type.indexOf("image")===0){q=r[s].getAsFile()}}if(q!==null){var p=new FileReader();p.onload=function(u){console.log(u.target.result);$("#pastedImage").show();g.show();$("#edit_imagem").val(u.target.result);$("#msg_tipo").val("image");i=true;m.attr("placeholder","Digite um título para sua imagem");document.getElementById("pastedImage").src=u.target.result};p.readAsDataURL(q)}};g.click(function(){$(this).hide();$("#pastedImage").hide();$("#msg_tipo").val("text");m.attr("placeholder","Digite sua mensagem");i=false});$(this).LongPolling({nomeDaVariavelLocalStorage:"dados",url:"../views/view.get_messages.php",tempoCarregamento:1000,metodo:"POST",dataHttp:{discussao_id:l},objetoParaPreencher:"",receberDados:function(p){o(p)}});m.keyup(function(p){var q=$(this);if(p.keyCode==13&&(p.shiftKey|p.ctrlKey)){if(q.val().trim().length>0){k.submit()}else{if(i==true){f.html("Digite um título para sua imagem").show().delay(3000).fadeOut()}else{f.html("Digite alguma mensagem").show().delay(3000).fadeOut()}m.focus()}}});$(this).keyup(function(p){if(p.altKey&&p.keyCode==73){document.getElementById("anexarArquivos").click()}});k.ajaxForm({url:"../modelos/model.mensagens.php",beforeSend:function(){if(document.getElementById("upload_imagem")){}h.html('<i class="fa fa-spinner fa-spin  fa-2x"></i>').attr("disabled",true)},uploadProgress:function(s,p,r,q){},success:function(p){if(p=="1"){h.html("<i class='fa fa-paper-plane fa-2x' aria-hidden='true'></i>").attr("disabled",false);m.val("").focus();e();$("#pastedImage, #gerResultImagesUploaded").hide();g.hide();$("#msg_tipo").val("text")}else{if(p=="2"){alert("Não foi possível fazer a alteração.")}else{alert("Houve um erro. Tente novamente.\nCódigo do erro:"+p);h.html("<i class='fa fa-paper-plane fa-2x' aria-hidden='true'></i>").attr("disabled",false)}}},complete:function(p){}});$("#btnSair").click(function(){$.get("funcoes/funcao.sair.php",function(){window.location.href="login"})});$("#btnAnexarArquivos").click(function(){});var n=[],a=[],b=$("#formUploadFiles");$("#anexarArquivos").change(function(){$("#displayImagensAnexos").css({height:"auto"}).show();var q=document.getElementById("anexarArquivos");var r="";for(var p=0;p<q.files.length;++p){n.push(q.files[p].name);console.log(q.files[p].size);console.log(q.files[p].type);console.log(q.files[p].name);a.push("file_"+p);b.submit()}$("#mostrarArquivos").html(r)});$("#btnDefinirPropt").click(function(){});b.ajaxForm({beforeSend:function(){},uploadProgress:function(s,p,r,q){},success:function(p){$("#gerResultImagesUploaded").html(p)},complete:function(p){}})});